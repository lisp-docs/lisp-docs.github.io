"use strict";(self.webpackChunklisp_docs_github_io=self.webpackChunklisp_docs_github_io||[]).push([[4945],{9120:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>d});var o=n(5893),a=n(1151);const i={},r="Structuring A Large caveman2 Project",s={id:"howto/large-caveman/index",title:"Structuring A Large caveman2 Project",description:"How To Structure a Large caveman2 Project Into Multiple Modules?",source:"@site/docs/howto/large-caveman/index.md",sourceDirName:"howto/large-caveman",slug:"/howto/large-caveman/",permalink:"/docs/howto/large-caveman/",draft:!1,unlisted:!1,editUrl:"https://github.com/lisp-docs/lisp-docs.github.io/tree/main/docs/howto/large-caveman/index.md",tags:[],version:"current",lastUpdatedBy:"daninus14",frontMatter:{},sidebar:"howtoSidebar",previous:{title:"Getting Started",permalink:"/docs/howto/webdev-hunchentoot/start"}},c={},d=[{value:"How To Structure a Large caveman2 Project Into Multiple Modules?",id:"how-to-structure-a-large-caveman2-project-into-multiple-modules",level:2},{value:"Answer",id:"answer",level:2},{value:"Further Reading",id:"further-reading",level:2}];function l(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",ul:"ul",...(0,a.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.h1,{id:"structuring-a-large-caveman2-project",children:"Structuring A Large caveman2 Project"}),"\n",(0,o.jsx)(t.h2,{id:"how-to-structure-a-large-caveman2-project-into-multiple-modules",children:"How To Structure a Large caveman2 Project Into Multiple Modules?"}),"\n",(0,o.jsxs)(t.p,{children:["How can I go about splitting large parts of a web app into modules to make it more manageable for writing ",(0,o.jsx)(t.code,{children:".asd"})," files and separating functionality."]}),"\n",(0,o.jsxs)(t.p,{children:["This is to avoid importing every file in the ",(0,o.jsx)(t.code,{children:".asd"})," file and prevent it from becoming bloated and unmanageable."]}),"\n",(0,o.jsxs)(t.p,{children:["For example, say I want to have an authentication module which has its own classes, routes, and views: How can I define it in a system say in ",(0,o.jsx)(t.code,{children:"/src/auth/auth.asd"})," and be able to use those routes in the main web app by importing it?"]}),"\n",(0,o.jsxs)(t.p,{children:["To use another package to define routes is itself not so clearly documented: ",(0,o.jsx)(t.a,{href:"https://stackoverflow.com/questions/76330818/how-to-define-caveman2-routes-in-multiple-files-packages/76332385#76332385",children:"https://stackoverflow.com/questions/76330818/how-to-define-caveman2-routes-in-multiple-files-packages/76332385#76332385"})]}),"\n",(0,o.jsxs)(t.p,{children:["But given that defroute is expecting an ",(0,o.jsx)(t.code,{children:"*app*"})," it looks like an app should be created as a caveman2 project, and then modules created outside of the project, and then another system should import the caveman2 project as a system, and then the other modules would depend on the caveman2 project as a base."]}),"\n",(0,o.jsx)(t.h2,{id:"answer",children:"Answer"}),"\n",(0,o.jsxs)(t.p,{children:["The way to do it is to add a ",(0,o.jsx)(t.code,{children:"my-project.base.asd"})," package which contains"]}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.code,{children:"config.lisp"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.code,{children:"db.lisp"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.code,{children:"view.lisp"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.code,{children:"web.lisp"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.code,{children:"main.lisp"})}),"\n"]}),"\n",(0,o.jsxs)(t.p,{children:["Then the original will contain the dependency on this ",(0,o.jsx)(t.code,{children:"my-project.base.asd"})," and any other asd projects you declare. That way you can make smaller system definition files and encourage proper breaking up of the application code into more independent modules you can reuse over applications."]}),"\n",(0,o.jsxs)(t.p,{children:["A key thing to think about here if you want to make your modules really independent is to not make them depend on the base system. For controllers, it gets tricky because of the macro ",(0,o.jsx)(t.code,{children:"defroute"}),". So probably a good approach is make a new macro that will instead make a list of routes to be defined once a ",(0,o.jsx)(t.code,{children:"*app*"})," variable is provided, and then call the ningle function to register a route (which is what defroute does when macroexpanded) on all those routes to be defined."]}),"\n",(0,o.jsxs)(t.p,{children:["So the ",(0,o.jsx)(t.code,{children:"my-project.asd"})," file will have a few dependencies:"]}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.code,{children:"my-project.base"})}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.code,{children:"my-project.auth"})," (for example of an independent module which would declare routes etc)"]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.code,{children:"my-project.main"})," which would then tie in auth into the project and would call some function/macro defined in the ",(0,o.jsx)(t.code,{children:"my-project.auth"})," package and pass it the ",(0,o.jsx)(t.code,{children:"my-project.web:*web*"})," app variable and define all relevant routes."]}),"\n"]}),"\n",(0,o.jsxs)(t.p,{children:["Note that in this example, if you are defining some ",(0,o.jsx)(t.code,{children:"user"})," class or anything that is persisted on the db, the ",(0,o.jsx)(t.code,{children:"my-project.main"})," will also be responsible for executing the code to persist that class exported or extend it applying specific project related data and then persist it."]}),"\n",(0,o.jsx)(t.h2,{id:"further-reading",children:"Further Reading"}),"\n",(0,o.jsxs)(t.p,{children:["Note that this advice is following the ",(0,o.jsx)(t.a,{href:"/docs/tutorial/projects/structuring_large_projects",children:"more traditional common lisp way of structuring projects"}),". Check out the ",(0,o.jsx)(t.a,{href:"/docs/tutorial/projects/package_inferred",children:"package inferred systems"})," guide for a different approach."]})]})}function h(e={}){const{wrapper:t}={...(0,a.a)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},1151:(e,t,n)=>{n.d(t,{Z:()=>s,a:()=>r});var o=n(7294);const a={},i=o.createContext(a);function r(e){const t=o.useContext(i);return o.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),o.createElement(i.Provider,{value:t},e.children)}}}]);